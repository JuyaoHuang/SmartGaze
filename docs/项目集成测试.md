## æ­¥éª¤
1. åˆ›å»º requirements.txt
2. ä¸Šä¼ é¡¹ç›®æ–‡ä»¶åˆ°å¼€å‘æ¿
3. æ¿€æ´» conda ç¯å¢ƒå¹¶å®‰è£…ä¾èµ–
4. éªŒè¯ä¾èµ–å®‰è£…ï¼ˆæ£€æŸ¥å†²çªï¼‰
5. æµ‹è¯•å¯åŠ¨æœåŠ¡
6. è®¿é—® Web ç•Œé¢æµ‹è¯•åŠŸèƒ½

## å¯åŠ¨æ—¥å¿—

æ‰§è¡Œ 

å¯åŠ¨åç«¯æ—¥å¿—ï¼š
```bash
============================================================
æ™ºèƒ½é—¨ç¦ç³»ç»Ÿå¯åŠ¨ä¸­...
============================================================

============================================================
æ™ºèƒ½é—¨ç¦ç³»ç»Ÿé…ç½®æ‘˜è¦ï¼š
============================================================
è¿è¡Œæ¨¡å¼ï¼š            ç”Ÿäº§æ¨¡å¼ (ç¡¬ä»¶)
æ‘„åƒå¤´æ¨¡å¼ï¼š          opencv
æ‘„åƒå¤´ç´¢å¼•ï¼š          9
æ‘„åƒå¤´åˆ†è¾¨ç‡ï¼š        640x480 @ 30fps
äººè„¸ç›¸ä¼¼åº¦é˜ˆå€¼ï¼š      0.5
ç§»åŠ¨æ£€æµ‹é˜ˆå€¼ï¼š        500 åƒç´ 
å¼€é—¨æŒç»­æ—¶é—´ï¼š        3 ç§’
æœåŠ¡å™¨åœ°å€ï¼š          http://0.0.0.0:8000
è®¿é—®åœ°å€ï¼š            http://localhost:8000
æ•°æ®åº“è·¯å¾„ï¼š          /home/topeet/face_detection_system/backend/database/database.db
GPIO é—¨é”å¼•è„šï¼š       æœªé…ç½®ï¼ˆæ—¥å¿—æ¨¡æ‹Ÿï¼‰
============================================================
æ­£åœ¨åˆå§‹åŒ–æ‘„åƒå¤´...
æ­£åœ¨å¯åŠ¨åå°å®ˆæŠ¤çº¿ç¨‹...

[OK] æ™ºèƒ½é—¨ç¦ç³»ç»Ÿå¯åŠ¨æˆåŠŸï¼
============================================================
INFO:     Application startup complete.
INFO:     Uvicorn running on http://0.0.0.0:8000 (Press CTRL+C to quit)
[face_engine] Decoded image: 640x480
scale=0.500000 dst_box=(0 40 319 279) allow_slight_change=1 _left_offset=0 _top_offset=40 padding_w=0 padding_h=80
convert image use cpu
finish
rknn_run
[face_engine] Warning: No face detected
[FaceEngine] No face detected in the image
[face_engine] Decoded image: 640x480
scale=0.500000 dst_box=(0 40 319 279) allow_slight_change=1 _left_offset=0 _top_offset=40 padding_w=0 padding_h=80
convert image use cpu
[face_engine] Detected 2 face(s), using the first one (score=0.999)
[face_engine] Face aligned to 112x112
[face_engine] Feature extracted successfully (norm=0.0733)
[FaceEngine] Feature extracted successfully
[face_engine] Decoded image: 640x480
scale=0.500000 dst_box=(0 40 319 279) allow_slight_change=1 _left_offset=0 _top_offset=40 padding_w=0 padding_h=80
convert image use cpu
finish
```

### å½•å…¥äººè„¸

å½•å…¥äººè„¸APIæ­£å¸¸è°ƒç”¨ï¼š
```bash
INFO:     192.168.50.227:60452 - "GET /api/video_stream HTTP/1.1" 200 OK
```

å‰ç«¯æ­£å¸¸å®ç°ï¼Œæ‰§è¡Œå½•å…¥äººè„¸åŠŸèƒ½æ—¶æ—¥å¿—ï¼š
```bash
[face_engine] Decoded image: 640x480
scale=0.500000 dst_box=(0 40 319 279) allow_slight_change=1 _left_offset=0 _top_offset=40 padding_w=0 padding_h=80
convert image use cpu
finish
rknn_run
[face_engine] Detected 1 face(s), using the first one (score=0.994)
[face_engine] Face aligned to 112x112
[face_engine] Feature extracted successfully (norm=0.0616)
[FaceEngine] Feature extracted successfully
INFO:     192.168.50.227:45120 - "POST /api/face/capture HTTP/1.1" 200 OK
[face_engine] Decoded image: 640x480
scale=0.500000 dst_box=(0 40 319 279) allow_slight_change=1 _left_offset=0 _top_offset=40 padding_w=0 padding_h=80
convert image use cpu
finish
rknn_run
[face_engine] Detected 1 face(s), using the first one (score=1.000)
[face_engine] Face aligned to 112x112
[face_engine] Feature extracted successfully (norm=0.0866)
[FaceEngine] Feature extracted successfully
INFO:     192.168.50.227:50558 - "POST /api/face/capture HTTP/1.1" 200 OK
```

å‰ç«¯æ˜¾ç¤ºï¼š"æˆåŠŸå½•å…¥"

### ä¸€é”®å¼€é—¨

åç«¯æ˜¾ç¤ºï¼š
```bash
INFO:     192.168.50.227:40834 - "POST /api/unlock HTTP/1.1" 200 OK
```
è¯´æ˜æ­£å¸¸è¿è¡Œ

### äººè„¸åˆ—è¡¨

äººè„¸åˆ—è¡¨æ­£å¸¸æ˜¾ç¤ºï¼š
```bash
INFO:     192.168.50.227:57448 - "GET /face_dashboard HTTP/1.1" 200 OK
INFO:     192.168.50.227:57448 - "GET /face_list HTTP/1.1" 200 OK
```

åˆ—è¡¨æ­£å¸¸æ˜¾ç¤ºå·²å½•å…¥äººè„¸ã€‚

åˆ é™¤åŠŸèƒ½æ­£å¸¸ï¼š
```bash
INFO:     192.168.50.227:33258 - "DELETE /api/face/jj HTTP/1.1" 200 OK
```
### ä¿®æ”¹å¯†ç 

ä¿®æ”¹ç™»å½•å¯†ç åŠŸèƒ½æ­£å¸¸ï¼š
```bash
INFO:     192.168.50.227:52348 - "POST /api/change_login_password HTTP/1.1" 200 OK
```


### æŠ¥é”™

å½“æˆ‘åœ¨é¢æ¿ç‚¹å‡»ä¿®æ”¹ç™»å½•å¯†ç åŠŸèƒ½åï¼Œä¸æ–­æŠ¥é”™
```bash
ERROR:root:Failed to read frame from camera
ERROR:root:Failed to read frame from camera
```

å³ä½¿é€€å‡ºç™»å½•ä¹Ÿä¸æ–­è¯»å–å¤±è´¥ã€‚

**ä¹Ÿå°±æ˜¯è¯´ï¼Œåœ¨äººè„¸å½•å…¥é¡µé¢æ‰§è¡Œå½•å…¥ç»“æŸä¹‹åï¼Œè®¿é—®å…¶ä»– urlï¼Œä¾‹å¦‚ä¿®æ”¹ç™»å½•å¯†ç ç­‰æ—¶ï¼Œæ‘„åƒå¤´èµ„æºä¸€ç›´æ²¡æœ‰é‡Šæ”¾ã€‚**
å®šä½åˆ°æŠ¥é”™æ—¥å¿—å¤„ï¼š`backend\core\camera.py`ä¸­çš„`get_frame`å‡½æ•°ã€‚

å‘ç°`backend\routers\stream.py`åœ¨è°ƒç”¨æ­¤å‡½æ•°ï¼Œ**æœ‰å¯èƒ½æ˜¯@router.get("/video_stream")ä¸€ç›´åœ¨å ç”¨èµ„æºï¼Œå³ä½¿äººè„¸å½•å…¥åŠŸèƒ½ç»“æŸåä¹Ÿæ²¡æœ‰é‡Šæ”¾æ‘„åƒå¤´ã€‚**

é‡æ–°ç™»å½•ç®¡ç†å‘˜é¢æ¿ï¼Œæ‰“å¼€"äººè„¸å½•å…¥"é¡µé¢ï¼Œç‚¹å‡»å½•å…¥äººè„¸æ—¶æŠ¥é”™ï¼š
```bash
[face_engine] Decoded image: 640x480
scale=0.500000 dst_box=(0 40 319 279) allow_slight_change=1 _left_offset=0 _top_offset=40 padding_w=0 padding_h=80
convert image use cpu
finish
rknn_run
[face_engine] Warning: No face detected
[FaceEngine] No face detected in the image
INFO:     192.168.50.227:56324 - "POST /api/face/capture HTTP/1.1" 200 OK
```
å‰ç«¯æ˜¾ç¤ºï¼šâ€œå½•å…¥å¤±è´¥ã€‚â€

**è¯´æ˜ä¸Šæ¬¡å½•å…¥äººè„¸åï¼Œæ‘„åƒå¤´ä¸€ç›´è¢«å ç”¨ã€‚**


### è§£å†³æ–¹æ¡ˆ

å®šä½åˆ°`backend\routers\stream.py`ä¸­çš„`@router.get("/video_stream")` æ­¤APIï¼Œä¿®æ”¹ `while true` å¾ªç¯ä½“ï¼Œä½¿ç”¨ä¸€çŠ¶æ€å˜é‡ä»£æ›¿ã€‚æŸ¥çœ‹`fronted\templates\face_input.html`ï¼Œå½“ç¦»å¼€æ­¤é¡µé¢æ—¶ï¼Œå‘Šè¯‰åå°ï¼Œå°†æ­¤ API å ç”¨çš„æ‘„åƒå¤´å®ä¾‹é”€æ¯ã€‚


ğŸ”§ å…³é”®ä¿®æ”¹

backend/routers/stream.pyï¼š

1. æ·»åŠ å®¢æˆ·ç«¯æ–­å¼€æ£€æµ‹ï¼ˆç¬¬ 37-39 è¡Œï¼‰ï¼š
    if await request.is_disconnected():
    logging.info("[VideoStream] Client disconnected, stopping stream")
    break
    - æ¯æ¬¡å¾ªç¯æ£€æµ‹å®¢æˆ·ç«¯æ˜¯å¦æ–­å¼€
    - æ–­å¼€æ—¶ç«‹å³åœæ­¢æµï¼Œé‡Šæ”¾æ‘„åƒå¤´
2. æ·»åŠ å¼‚å¸¸å¤„ç†å’Œèµ„æºæ¸…ç†ï¼ˆç¬¬ 63-66 è¡Œï¼‰ï¼š
    finally:
    logging.info("[VideoStream] Stream stopped, camera resource released")
    - ç¡®ä¿æ— è®ºå¦‚ä½•éƒ½ä¼šè®°å½•èµ„æºé‡Šæ”¾
3. æ·»åŠ å¸§ç‡æ§åˆ¶ï¼ˆç¬¬ 61 è¡Œï¼‰ï¼š
    await asyncio.sleep(0.033)  # çº¦ 30 FPS
    - é¿å…å ç”¨è¿‡å¤š CPU
4. æ”¹ä¸ºå¼‚æ­¥ç”Ÿæˆå™¨ï¼š
    - def generate_frames() â†’ async def generate_frames()
    - æ”¯æŒå¼‚æ­¥æ–­å¼€æ£€æµ‹

## æ–°çš„é—®é¢˜

å®Œæˆä¸Šè¿°ä¿®æ”¹åï¼Œå¯åŠ¨åç«¯æ—¶æŠ¥é”™ï¼šï¼ˆæ£€æµ‹åˆ°äººè„¸åå‡ºçš„é”™ï¼‰
```bash
[face_engine] Detected 1 face(s), using the first one (score=0.614)
[face_engine] Face aligned to 112x112
[face_engine] Feature extracted successfully (norm=0.0434)
[FaceEngine] Feature extracted successfully
Exception in thread Thread-1:
Traceback (most recent call last):
  File "/home/topeet/miniconda3/envs/rknn/lib/python3.8/threading.py", line 932, in _bootstrap_inner
    self.run()
  File "/home/topeet/face_detection_system/backend/core/backgroundThread.py", line 115, in run
    sim = face_engine.compute_similarity(
  File "/home/topeet/face_detection_system/backend/core/face_engine.py", line 185, in compute_similarity
    if not feature1 or not feature2:
ValueError: The truth value of an array with more than one element is ambiguous. Use a.any() or a.all()
```
**å¹¶ä¸”**ï¼š
1. å‰ç«¯é¡µé¢æ— æ³•ç™»å½•
2. åå°æ—¥å¿—å¡åœ¨ä¸Šè¿°è®°å½•